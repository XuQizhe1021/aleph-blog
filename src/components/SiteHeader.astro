---
import { siteConfig } from '../site.config';
import { withBase } from '../utils/paths';
---

<header class="site-header">
	<div class="inner">
		<a class="brand" href={withBase('/')}>
			<span class="brand-dot" aria-hidden="true"></span>
			<span class="brand-text">{siteConfig.title}</span>
		</a>
		<nav class="nav" aria-label="主导航">
			{siteConfig.nav.map((item) => (
				<a class="nav-link" href={withBase(item.href)}>
					{item.label}
				</a>
			))}
		</nav>
		<div class="actions">
			<button class="btn menu" id="nav-toggle" type="button" aria-expanded="false" aria-controls="nav-drawer">
				<span class="muted">菜单</span>
			</button>
			<button class="btn" id="theme-toggle" type="button">
				<span class="muted" id="theme-label">主题</span>
			</button>
		</div>
	</div>
	<div class="drawer" id="nav-drawer" aria-hidden="true">
		<div class="drawer-backdrop" id="nav-backdrop"></div>
		<div class="drawer-panel panel">
			<div class="drawer-head">
				<div class="drawer-title">导航</div>
				<button class="btn" id="nav-close" type="button">关闭</button>
			</div>
			<nav class="drawer-links" aria-label="移动端导航">
				{siteConfig.nav.map((item) => (
					<a class="drawer-link" href={withBase(item.href)}>
						{item.label}
					</a>
				))}
			</nav>
		</div>
	</div>
	<script is:inline>
		(() => {
			const btn = document.getElementById('theme-toggle');
			const label = document.getElementById('theme-label');
			const key = 'theme';
			const get = () => document.documentElement.dataset.theme || 'light';
			const set = (theme) => {
				document.documentElement.dataset.theme = theme;
				localStorage.setItem(key, theme);
				if (label) label.textContent = theme === 'dark' ? '深色' : '浅色';
			};
			set(get());
			btn?.addEventListener('click', () => set(get() === 'dark' ? 'light' : 'dark'));
		})();
	</script>
	<script is:inline>
		(() => {
			const root = document.documentElement;
			const openBtn = document.getElementById('nav-toggle');
			const closeBtn = document.getElementById('nav-close');
			const backdrop = document.getElementById('nav-backdrop');
			const drawer = document.getElementById('nav-drawer');

			const setOpen = (open) => {
				root.dataset.navOpen = open ? '1' : '';
				if (drawer) drawer.setAttribute('aria-hidden', open ? 'false' : 'true');
				if (openBtn) openBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
			};

			openBtn?.addEventListener('click', () => setOpen(root.dataset.navOpen !== '1'));
			closeBtn?.addEventListener('click', () => setOpen(false));
			backdrop?.addEventListener('click', () => setOpen(false));
			window.addEventListener('keydown', (e) => {
				if (e.key === 'Escape') setOpen(false);
			});
			drawer?.querySelectorAll('a').forEach((a) => a.addEventListener('click', () => setOpen(false)));
		})();
	</script>
</header>

<style>
	.site-header {
		position: sticky;
		top: 0;
		z-index: 100;
		border-bottom: 1px solid var(--border);
		background: color-mix(in oklab, var(--panel-strong), transparent 20%);
		backdrop-filter: blur(16px);
	}

	.inner {
		width: min(1140px, calc(100% - 32px));
		margin: 0 auto;
		height: 62px;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 12px;
	}

	.brand {
		display: inline-flex;
		align-items: center;
		gap: 10px;
		text-decoration: none;
	}

	.brand-dot {
		width: 12px;
		height: 12px;
		border-radius: 999px;
		background: linear-gradient(135deg, var(--accent), var(--accent2));
		box-shadow: 0 0 0 4px color-mix(in oklab, var(--accent), transparent 85%);
	}

	.brand-text {
		font-weight: 650;
		letter-spacing: 0.2px;
	}

	.nav {
		display: flex;
		align-items: center;
		gap: 8px;
		flex-wrap: wrap;
		justify-content: center;
	}

	.nav-link {
		padding: 8px 10px;
		border-radius: 999px;
		color: var(--muted);
		text-decoration: none;
	}

	.nav-link:hover {
		color: var(--text);
		background: color-mix(in oklab, var(--panel-strong), transparent 25%);
		text-decoration: none;
	}

	.actions {
		display: flex;
		align-items: center;
		gap: 8px;
	}

	.menu {
		display: none;
	}

	.drawer {
		display: none;
	}

	.drawer-backdrop {
		position: fixed;
		inset: 0;
		background: rgba(0, 0, 0, 0.45);
		backdrop-filter: blur(6px);
		z-index: 140;
	}

	.drawer-panel {
		position: fixed;
		top: 74px;
		left: 16px;
		right: 16px;
		z-index: 150;
		padding: 14px;
		display: grid;
		gap: 12px;
	}

	.drawer-head {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 12px;
	}

	.drawer-title {
		font-weight: 800;
	}

	.drawer-links {
		display: grid;
		gap: 8px;
	}

	.drawer-link {
		padding: 12px 12px;
		border-radius: 12px;
		border: 1px solid var(--border);
		background: color-mix(in oklab, var(--panel-strong), transparent 18%);
		color: var(--text);
		text-decoration: none;
	}

	.drawer-link:hover {
		text-decoration: none;
		border-color: color-mix(in oklab, var(--accent), var(--border) 35%);
	}

	html[data-nav-open='1'] .drawer {
		display: block;
	}

	@media (max-width: 720px) {
		.inner {
			height: auto;
			padding: 10px 0;
			align-items: start;
		}
		.nav {
			display: none;
		}
		.menu {
			display: inline-flex;
		}
	}
</style>
