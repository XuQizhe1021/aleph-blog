---
import { siteConfig } from '../site.config';
---

<header class="site-header">
	<div class="inner">
		<a class="brand" href="/">
			<span class="brand-dot" aria-hidden="true"></span>
			<span class="brand-text">{siteConfig.title}</span>
		</a>
		<button class="btn menu-btn" id="menu-toggle" type="button" aria-label="打开菜单">菜单</button>
		<nav class="nav" aria-label="主导航">
			{siteConfig.nav.map((item) => (
				<a class="nav-link" href={item.href}>
					{item.label}
				</a>
			))}
		</nav>
		<div class="actions">
			<button class="btn" id="theme-toggle" type="button">
				<span class="muted" id="theme-label">主题</span>
			</button>
		</div>
	</div>
	<div class="drawer" id="drawer" hidden>
		<div class="drawer-backdrop" id="drawer-backdrop" aria-hidden="true"></div>
		<div class="drawer-panel panel">
			<div class="drawer-head">
				<div class="drawer-title">{siteConfig.title}</div>
				<button class="btn" id="drawer-close" type="button">关闭</button>
			</div>
			<nav class="drawer-nav" aria-label="移动端导航">
				{siteConfig.nav.map((item) => (
					<a class="drawer-link" href={item.href}>
						{item.label}
					</a>
				))}
			</nav>
		</div>
	</div>
	<script is:inline>
		(() => {
			const btn = document.getElementById('theme-toggle');
			const label = document.getElementById('theme-label');
			const key = 'theme';
			const get = () => document.documentElement.dataset.theme || 'light';
			const set = (theme) => {
				document.documentElement.dataset.theme = theme;
				localStorage.setItem(key, theme);
				if (label) label.textContent = theme === 'dark' ? '深色' : '浅色';
			};
			set(get());
			btn?.addEventListener('click', () => set(get() === 'dark' ? 'light' : 'dark'));

			const drawer = document.getElementById('drawer');
			const openBtn = document.getElementById('menu-toggle');
			const closeBtn = document.getElementById('drawer-close');
			const backdrop = document.getElementById('drawer-backdrop');

			const setDrawer = (open) => {
				if (!drawer) return;
				drawer.hidden = !open;
				document.body.style.overflow = open ? 'hidden' : '';
			};

			openBtn?.addEventListener('click', () => setDrawer(true));
			closeBtn?.addEventListener('click', () => setDrawer(false));
			backdrop?.addEventListener('click', () => setDrawer(false));
			window.addEventListener('keydown', (e) => {
				if (e.key === 'Escape') setDrawer(false);
			});

			drawer?.addEventListener('click', (e) => {
				const a = e.target?.closest?.('a');
				if (a) setDrawer(false);
			});
		})();
	</script>
</header>

<style>
	.site-header {
		position: sticky;
		top: 0;
		z-index: 20;
		border-bottom: 1px solid var(--border);
		background: color-mix(in oklab, var(--panel-strong), transparent 20%);
		backdrop-filter: blur(16px);
	}

	.inner {
		width: min(1140px, calc(100% - 32px));
		margin: 0 auto;
		height: 62px;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 12px;
	}

	.brand {
		display: inline-flex;
		align-items: center;
		gap: 10px;
		text-decoration: none;
	}

	.brand-dot {
		width: 12px;
		height: 12px;
		border-radius: 999px;
		background: linear-gradient(135deg, var(--accent), var(--accent2));
		box-shadow: 0 0 0 4px color-mix(in oklab, var(--accent), transparent 85%);
	}

	.brand-text {
		font-weight: 650;
		letter-spacing: 0.2px;
	}

	.nav {
		display: flex;
		align-items: center;
		gap: 8px;
	}

	.menu-btn {
		display: none;
	}

	.nav-link {
		padding: 8px 10px;
		border-radius: 999px;
		color: var(--muted);
		text-decoration: none;
	}

	.nav-link:hover {
		color: var(--text);
		background: color-mix(in oklab, var(--panel-strong), transparent 25%);
		text-decoration: none;
	}

	.actions {
		display: flex;
		align-items: center;
		gap: 8px;
	}

	.drawer {
		position: fixed;
		inset: 0;
		z-index: 60;
		display: grid;
	}

	.drawer-backdrop {
		position: absolute;
		inset: 0;
		background: rgba(0, 0, 0, 0.35);
		backdrop-filter: blur(4px);
	}

	.drawer-panel {
		position: relative;
		width: min(420px, calc(100% - 24px));
		margin: 12px;
		padding: 14px;
		align-self: start;
		justify-self: end;
		display: grid;
		gap: 12px;
	}

	.drawer-head {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 10px;
	}

	.drawer-title {
		font-weight: 800;
	}

	.drawer-nav {
		display: grid;
		gap: 8px;
	}

	.drawer-link {
		padding: 10px 12px;
		border-radius: 12px;
		border: 1px solid var(--border);
		background: color-mix(in oklab, var(--panel-strong), transparent 18%);
		text-decoration: none;
		color: var(--text);
	}

	.drawer-link:hover {
		text-decoration: none;
		border-color: color-mix(in oklab, var(--accent), var(--border) 30%);
	}

	@media (max-width: 720px) {
		.nav {
			display: none;
		}
		.menu-btn {
			display: inline-flex;
		}
	}
</style>
