---
import { siteConfig } from '../site.config';
import { withBase } from '../utils/paths';
---

<header class="site-header">
	<div class="inner">
		<a class="brand" href={withBase('/')}>
			<span class="brand-dot" aria-hidden="true"></span>
			<span class="brand-text">{siteConfig.title}</span>
		</a>
		<nav class="nav" aria-label="主导航">
			{siteConfig.nav.map((item) => (
				<a class="nav-link" href={withBase(item.href)}>
					{item.label}
				</a>
			))}
		</nav>
		<div class="actions">
			<button class="btn menu" id="nav-toggle" type="button" aria-expanded="false" aria-controls="nav-drawer">
				<span class="muted">菜单</span>
			</button>
			<button class="btn" id="theme-toggle" type="button">
				<span class="muted" id="theme-label">主题</span>
			</button>
		</div>
	</div>
	<div class="nav-drop" id="nav-drawer" aria-hidden="true">
		<nav class="nav-drop-inner" aria-label="移动端导航">
			{siteConfig.nav.map((item) => (
				<a class="nav-drop-link" href={withBase(item.href)}>
					{item.label}
				</a>
			))}
		</nav>
	</div>
	<script is:inline>
		(() => {
			const btn = document.getElementById('theme-toggle');
			const label = document.getElementById('theme-label');
			const key = 'theme';
			const get = () => document.documentElement.dataset.theme || 'light';
			const set = (theme) => {
				document.documentElement.dataset.theme = theme;
				localStorage.setItem(key, theme);
				if (label) label.textContent = theme === 'dark' ? '深色' : '浅色';
			};
			set(get());
			btn?.addEventListener('click', () => set(get() === 'dark' ? 'light' : 'dark'));
		})();
	</script>
	<script is:inline>
		(() => {
			const root = document.documentElement;
			const header = document.querySelector('.site-header');
			const openBtn = document.getElementById('nav-toggle');
			const drawer = document.getElementById('nav-drawer');

			const setHeaderHeight = () => {
				if (!(header instanceof HTMLElement)) return;
				root.style.setProperty('--site-header-height', `${header.offsetHeight}px`);
			};

			const setOpen = (open) => {
				root.dataset.navOpen = open ? '1' : '';
				if (drawer) drawer.setAttribute('aria-hidden', open ? 'false' : 'true');
				if (openBtn) openBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
				requestAnimationFrame(() => setHeaderHeight());
			};

			setHeaderHeight();
			openBtn?.addEventListener('click', () => setOpen(root.dataset.navOpen !== '1'));
			window.addEventListener('keydown', (e) => {
				if (e.key === 'Escape') setOpen(false);
			});
			drawer?.querySelectorAll('a').forEach((a) => a.addEventListener('click', () => setOpen(false)));
			window.addEventListener('resize', () => setHeaderHeight());
		})();
	</script>
</header>

<style>
	.site-header {
		position: sticky;
		top: 0;
		z-index: 100;
		border-bottom: 1px solid var(--border);
		background: color-mix(in oklab, var(--panel-strong), transparent 20%);
		backdrop-filter: blur(16px);
	}

	.inner {
		width: min(1140px, calc(100% - 32px));
		margin: 0 auto;
		height: 62px;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 12px;
	}

	.brand {
		display: inline-flex;
		align-items: center;
		gap: 10px;
		text-decoration: none;
	}

	.brand-dot {
		width: 12px;
		height: 12px;
		border-radius: 999px;
		background: linear-gradient(135deg, var(--accent), var(--accent2));
		box-shadow: 0 0 0 4px color-mix(in oklab, var(--accent), transparent 85%);
	}

	.brand-text {
		font-weight: 650;
		letter-spacing: 0.2px;
	}

	.nav {
		display: flex;
		align-items: center;
		gap: 8px;
		flex-wrap: wrap;
		justify-content: center;
	}

	.nav-link {
		padding: 8px 10px;
		border-radius: 999px;
		color: var(--muted);
		text-decoration: none;
	}

	.nav-link:hover {
		color: var(--text);
		background: color-mix(in oklab, var(--panel-strong), transparent 25%);
		text-decoration: none;
	}

	.actions {
		display: flex;
		align-items: center;
		gap: 8px;
	}

	.menu {
		display: none;
	}

	.drawer {
		display: none;
	}

	.nav-drop {
		display: none;
		overflow: hidden;
		max-height: 0;
		opacity: 0;
		transform: translateY(-10px);
		transition:
			max-height 260ms ease,
			opacity 200ms ease,
			transform 200ms ease;
		border-top: 1px solid var(--border);
		background: color-mix(in oklab, var(--panel-strong), transparent 20%);
		backdrop-filter: blur(16px);
	}

	.nav-drop-inner {
		width: min(1140px, calc(100% - 32px));
		margin: 0 auto;
		padding: 10px 0 14px;
		display: grid;
		gap: 8px;
	}

	.nav-drop-link {
		padding: 12px 12px;
		border-radius: 12px;
		border: 1px solid var(--border);
		background: color-mix(in oklab, var(--panel-strong), transparent 18%);
		color: var(--text);
		text-decoration: none;
	}

	.nav-drop-link:hover {
		text-decoration: none;
		border-color: color-mix(in oklab, var(--accent), var(--border) 35%);
	}

	html[data-nav-open='1'] .nav-drop {
		max-height: 320px;
		opacity: 1;
		transform: translateY(0);
	}

	@media (max-width: 720px) {
		.inner {
			height: auto;
			padding: 10px 0;
			align-items: start;
		}
		.nav {
			display: none;
		}
		.menu {
			display: inline-flex;
		}
		.nav-drop {
			display: block;
		}
	}
</style>
