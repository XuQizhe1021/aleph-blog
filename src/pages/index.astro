---
import Layout from '../layouts/Layout.astro';
import PostCard from '../components/PostCard.astro';
import { getPublicPosts, getAllCategories } from '../utils/blog';

const posts = await getPublicPosts();
const categories = getAllCategories(posts).slice(0, 8);
const latest = posts.slice(0, 8);

---

<Layout title="首页">
	<section class="hero panel">
		<div class="hero-title">欢迎来到我的博客</div>
		<p class="hero-sub muted">支持 Markdown、LaTeX、分类、全文搜索与舒适阅读体验。</p>
		<div class="hero-actions">
			<a class="btn" href="/posts">浏览文章</a>
			<a class="btn" href="/search">搜索</a>
		</div>
	</section>

	<section class="section">
		<div class="section-head">
			<h2>最新文章</h2>
			<a class="muted" href="/posts">查看全部 →</a>
		</div>
		<div class="grid">
			{latest.length ? latest.map((post) => <PostCard post={post} />) : <div class="muted">暂无文章</div>}
		</div>
	</section>

	<section class="section">
		<div class="section-head">
			<h2>热门分类</h2>
			<a class="muted" href="/categories">查看全部 →</a>
		</div>
		<div class="cats">
			{categories.length ? (
				categories.map((c) => (
					<a class="cat panel" href={`/categories/${encodeURIComponent(c.category)}`}>
						<div class="cat-name">{c.category}</div>
						<div class="cat-count muted">{c.count} 篇</div>
					</a>
				))
			) : (
				<div class="muted">暂无分类</div>
			)}
		</div>
	</section>
</Layout>

<style>
	.hero {
		padding: 22px 18px;
		display: grid;
		gap: 8px;
	}

	.hero-title {
		font-size: clamp(22px, 4.2vw, 34px);
		font-weight: 800;
		letter-spacing: 0.2px;
	}

	.hero-sub {
		margin: 0;
	}

	.hero-actions {
		display: flex;
		flex-wrap: wrap;
		gap: 10px;
		margin-top: 6px;
	}

	.section {
		margin-top: 18px;
	}

	.section-head {
		display: flex;
		align-items: baseline;
		justify-content: space-between;
		gap: 10px;
		margin: 10px 2px;
	}

	h2 {
		margin: 0;
	}

	.grid {
		display: grid;
		grid-template-columns: repeat(2, minmax(0, 1fr));
		gap: 12px;
	}

	.cats {
		display: grid;
		grid-template-columns: repeat(4, minmax(0, 1fr));
		gap: 12px;
	}

	.cat {
		padding: 14px 14px 12px;
		text-decoration: none;
		display: grid;
		gap: 6px;
	}

	.cat:hover {
		border-color: color-mix(in oklab, var(--accent), var(--border) 30%);
		text-decoration: none;
	}

	.cat-name {
		font-weight: 700;
	}

	.cat-count {
		font-size: 13px;
	}

	@media (max-width: 980px) {
		.grid {
			grid-template-columns: 1fr;
		}
		.cats {
			grid-template-columns: repeat(2, minmax(0, 1fr));
		}
	}
</style>
