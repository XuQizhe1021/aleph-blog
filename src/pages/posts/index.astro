---
import Layout from '../../layouts/Layout.astro';
import PostCard from '../../components/PostCard.astro';
import { getPublicPosts, getAllCategories } from '../../utils/blog';

const posts = await getPublicPosts();
const categories = getAllCategories(posts);
---

<Layout title="文章">
	<section class="head panel">
		<div class="title">文章</div>
		<div class="muted">共 {posts.length} 篇</div>
	</section>

	<section class="filters panel">
		<div class="label muted">分类</div>
		<div class="chips">
			<a class="chip" href="/posts">全部</a>
			{categories.map((c) => (
				<a class="chip" href={`/categories/${encodeURIComponent(c.category)}`}>
					{c.category} <span class="muted">({c.count})</span>
				</a>
			))}
		</div>
	</section>

	<section class="list">
		{posts.length ? posts.map((post) => <PostCard post={post} />) : <div class="muted">暂无文章</div>}
	</section>
</Layout>

<style>
	.head {
		padding: 18px;
		display: flex;
		align-items: baseline;
		justify-content: space-between;
		gap: 10px;
	}

	.title {
		font-size: 24px;
		font-weight: 800;
	}

	.filters {
		margin-top: 14px;
		padding: 14px;
		display: grid;
		gap: 10px;
	}

	.chips {
		display: flex;
		flex-wrap: wrap;
		gap: 8px;
	}

	.chip {
		display: inline-flex;
		align-items: center;
		height: 30px;
		padding: 0 10px;
		border-radius: 999px;
		border: 1px solid var(--border);
		background: color-mix(in oklab, var(--panel-strong), transparent 18%);
		color: var(--text);
		text-decoration: none;
		font-size: 13px;
	}

	.chip:hover {
		text-decoration: none;
		border-color: color-mix(in oklab, var(--accent), var(--border) 30%);
	}

	.list {
		margin-top: 14px;
		display: grid;
		gap: 12px;
	}
</style>

